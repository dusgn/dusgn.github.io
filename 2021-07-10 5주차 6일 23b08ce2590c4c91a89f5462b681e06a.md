# 2021-07-10 5주차 6일

#1     스프링이 관리하는 항목을 이해하자

스프링 데이터 JPA 를 사용하기 위해

ArticleRepository 인터페이스에 JPARepository 를 상속받아 저장소로 만들었다.

Article entity도 만든 뒤

데이터베이스 연결 확인을 위해 DB에 객체를 저장한 후 받아와 비교하는 Test를 작성하였는데

복습하기 위해 애너테이션을 제외하고 구조를 짠 뒤 애너테이션을 하나씩 붙여나갔다.

```java
class ArticleRepositoryTest{

    @Autowired
    ArticleRepository articleRepository;

    @Test
    public void 게시글_저장후_불러오기() {
        // given
        String title = "테스트 제목";
        String content = "테스트 본문";

        Article article = new Article(title, content);
        articleRepository.save(article);

        // when
        List<Article> articleList = articleRepository.findAll();

        // then
        Article article1 = articleList.get(0);
				assertThat(article1.getTitle()).isEqualTo(title);
				assertThat(article1.getContent()).isEqualTo(content);
    }

}
```

일단 배운걸 복기했을 땐

Repository가 JPA를 쓰기 때문에 스프링이 Repository를 알고있기 때문에 @Autowired 로 주입해줄거라 생각했는데 테스트가 자꾸 실패했다.

결과적으론 @SpringBootTest 를 붙여 줘야 했다.

헷갈린 이유가 강의에선 OCP설명을 위해 초반엔 springboot가 Repository를 관리하지 않고 직접 configuration bean으로 넣어주는 방식이기 때문에 springboot를 구동하지 않아도 테스트가 통과한다는걸 알게되었다. 그런데 내가 하는 방식은 이미 스프링부트에게 Repository 관리를 맡기고 springboot를 구동해 주지 않아 repository를 주입받지 못하는 것이었다.

@SpringbootTest 를 붙여주고 나니 @Autowired 옆에 오른쪽을 향하는 콩이 생긴걸 확인할 수 있었다.

그 이후 심화과정 강의를 보니 Spring이 관리하지 않는 파일들...? 그 구동되지 않아도 할 수 있는 테스트... 라고 해야되나.. 그런것들은 @SpringbootTest를 붙이지 않은걸 알아보게 되었다.

#2    JPA @Id @GeneratedValue(strategy = GenerationType.AUTO) @GeneratedValue(strategy = GenerationType.IDENTITY) 차이

찾아봐도 모르겠다 지금의 내가 이해할 수 있는 내용은 아닌듯하다. 조금더 공부하고 찾아봐야겠다.

일단

AUTO 는 id생성을 위해 hibernate_sequence 테이블의 시퀀스 값을 가져와 업데이트 하고 그 값으로 insert쿼리를 사용한다.

IDENTITY는 insert 쿼리가 pk 값 없이 수행되며 데이터베이스의 auto_increment동작이 수행된다.

![2021-07-10%205%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%206%E1%84%8B%E1%85%B5%E1%86%AF%2023b08ce2590c4c91a89f5462b681e06a.jpeg](2021-07-10%205%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%206%E1%84%8B%E1%85%B5%E1%86%AF%2023b08ce2590c4c91a89f5462b681e06a.jpeg)

#3    @Configuration

xml 설정을 대체할 수 있는 Java Config

Java Config 란 자바 클래스 파일을 설정 파일로 사용하겠다는 뜻

@Configuration 애너테이션을 붙여서 표시한다.

#4   Resolved [org.springframework.web.HttpMediaTypeNotSupportedException: Content type 'application/x-www-form-urlencoded;charset=UTF-8' not supported]\

ARC를 통해선값이 잘 들어가는데 프론트를 띄우면 값이 안들어간다...

이유는 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

content-type이 json 형식이 아니다...

서버에서 Json 포멧으로 데이터를 받도록 했다면 클라이언트에서 HttpRequestMessage안의 content-type으로 설정될 수 있을 만한 값은 

application/x-www-form-urlencoded와 application/json이 두가지라고 한다.

```java
// 회원가입 요청 로직
@PostMapping("/user/signup")
public String registerUser(@RequestBody SignupRequestDto requestDto) {
    userService.registerUser(requestDto);
    return "redirect:/";
}
```

너무 당당하게 @RequestBody 즉 JSON으로 받겠다고 써놔서; 

서버단을 고치진 못하겠고 (읽어도 모르겟다 그리고 잘 돌아가는 서버를 굳이 만지고 싶지 않다.)

ajax로 보내줄 계획이다.

아휴 스크립트문 만들었다.

```jsx
//head  추가 잊지마
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    function createUser(){
        let username = $('#input-username').val();
        let password = $('#input-password').val();
        let data = {'username': username, 'password': password};

        $.ajax({
            type: "POST",
            url: '/user/signup',
            contentType: "application/json",
            data:JSON.stringify(data),
            success: function (response) {
                alert('5시간 걸렸다');
            }
        });
    }
```

삽질은 좋은데 프론트에서 이러고잇다... 너무 자괴감 드네...ㅋㅋㅋㅋ

참고 : [https://caileb.tistory.com/192](https://caileb.tistory.com/192)

읽어보면 좋음

[https://blog.naver.com/PostView.naver?blogId=writer0713&logNo=221853596497&redirect=Dlog&widgetTypeCall=true&directAccess=false](https://blog.naver.com/PostView.naver?blogId=writer0713&logNo=221853596497&redirect=Dlog&widgetTypeCall=true&directAccess=false)